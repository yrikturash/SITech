@model System.Collections.Generic.IEnumerable<SITech.DTO.MenuItemViewModel>
@if (Request.IsAuthenticated)
{
    <!-- START PANEL -->
    <div class="panel panel-transparent">
        <div class="panel-heading">
            <div class="panel-title">
                Active Menu
            </div>
            <a class="btn btn-default" style="margin-left: 25px; opacity: 1;" href="#" id="create_menu_item" data-type="active" >Add New Menu Item</a>
            <div class="clearfix"></div>
        </div>
        @using (Html.BeginForm("MenuItems", "WebApp", FormMethod.Post, new { @id = "frm" }))
        {
            <div class="row">
                <div class="col-md-12" style="margin-top: 20px;">
                    <!-- COLUMN FILTER DATA TABLE -->
                    <div class="widget widget-table">
                        <div class="widget-content">
                            <table id="datatable-column-filter" class="table table-sorting table-striped table-hover datatable">
                                <thead>
                                    <tr>
                                        <th style="width: 15px;"></th>
                                        <th>Name</th>
                                        <th>Price</th>
                                        <th>Type</th>
                                        <th>Menu Price</th>
                                        <th>% Profit</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td><input type="checkbox" class="itemCheckbox" data-code="@item.MenuItemId" name="selectedItems" value="@item.MenuItemId" /></td>
                                            <td>@item.ItemName</td>
                                            <td>$@item.ItemPrice.ToString("#,##0.00")</td>
                                            <td>@item.ItemType</td>
                                            <td>$@item.MenuPrice.ToString("#,##0.00")</td>
                                            <td>@item.Profit%</td>
                                        </tr>
                                    }

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- END COLUMN FILTER DATA TABLE -->
                </div>
            </div>

            <div class="row" style="margin-left: 5px;">
                <input type="button" class="btn btn-default" value="Deactivate" id="deactivate_menu_item" />
                <input type="button" class="btn btn-default" value="Edit" id="edit_menu_item" />
                <input type="button" class="btn btn-default" value="Delete" id="delete_menu_item" />
            </div>
        }
    </div>
            <!-- END PANEL -->
}
else
{
    <h2> Logged off and now in the other view</h2>
}


<script>
    $(function () {
        addColumnFiltersDataTable("#datatable-column-filter", 6, 1);
        $('.row-filter th:first').empty().append('<input type="checkbox" id="check_all" />');
        $('th:first').attr("class", "");
    });

    /*--------------------------- Check/Uncheck all ----------------------------------------*/
    $("body").on("click", "#check_all", function () {
        if ($('#check_all').is(":checked")) {
            $('.itemCheckbox').prop("checked", true);
        } else {
            $('.itemCheckbox').prop("checked", false);
        }
    });
    /*--------------------------- Validation ----------------------------------------*/
    $("body").on("submit", "#frm", function () {
        if ($('.itemCheckbox:checked').length <= 0) {
            alert('Select at least one customer!');
            return false;
        }
    });
    /*--------------------------- delete menu items ----------------------------------------*/
    $("body").on("click", "#delete_menu_item", function () {
        if (confirm("Are you sure?")) {
            var menuItemList = [];
            $(".itemCheckbox:checked").each(function () {
                menuItemList.push(this.value);
            });

            //console.log(menuItemList);
            $.ajax({
                url: '/api/menuitem/delete?ids='+menuItemList.join(","),
                type: 'delete',
                //data: { 'ids': menuItemList },
                success: function (result) {
                    $(".itemCheckbox:checked").each(function () {
                        this.closest('tr').remove();
                    });
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

    });
    /*--------------------------- Deactivate menu item ----------------------------------------*/
    $("body").on("click", "#deactivate_menu_item", function () {
        if (confirm("Are you sure?")) {
            var menuItemList = [];
            $(".itemCheckbox:checked").each(function () {
                menuItemList.push(this.value);
            });

            //console.log(menuItemList);
            $.ajax({
                url: '/api/menuitem/deactivate?ids=' + menuItemList.join(','),
                type: 'put',
                //data: { 'menuItemList': menuItemList },
                success: function (result) {
                    $(".itemCheckbox:checked").each(function () {
                        this.closest('tr').remove();
                    });
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

    });
</script>



